cmake_minimum_required(VERSION 3.25)
project(MachEmuPackageTest CXX)

if(MSVC)
  set(build_type $<CONFIG>)
else()
  set(build_type ${CMAKE_BUILD_TYPE})
endif()

find_package(mach_emu CONFIG REQUIRED)

add_executable(MachEmuPackageTest source/MachEmuPackageTest.cpp)

if(DEFINED artifacts_dir OR DEFINED zlib_bin_dir)
    include(../pythonTestDeps.cmake)

    generatePythonUnitTestDeps(${artifacts_dir} testControllersPathNotUsed testProgramsPathNoUsed ${zlib_bin_dir})

    add_custom_command(
        TARGET MachEmuPackageTest POST_BUILD
        COMMAND ${CMAKE_COMMAND} -E copy_if_different ${CMAKE_CURRENT_BINARY_DIR}/MachineTestDeps${build_type}.py ${CMAKE_CURRENT_SOURCE_DIR}/source/MachineTestDeps.py
    )
endif()

target_link_libraries(MachEmuPackageTest mach_emu::mach_emu)
